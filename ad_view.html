<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ad Processor</title>
    <script src="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.js"></script>
    <style> 
        body { margin: 0; background: #000; overflow: hidden; font-family: monospace; font-size: 14px; } 
        #video-container { width: 100vw; height: 100vh; display: block; }
        #log { 
            position: absolute; top: 10px; left: 10px; z-index: 100; 
            color: #00ff00; background: rgba(0,0,0,0.7); padding: 10px; border: 1px solid #00ff00;
        }
    </style>
</head>
<body>

    <div id="log">Status: Initializing...</div>

    <div id="video-container">
        <video id="my-video">
            <source src="https://cdn.fluidplayer.com/videos/valerian-1080p.m4v" type="video/mp4"/>
        </video>
    </div>

    <script>
        // --- SETTINGS ---
        const videoTag = 'https://homelybottle.com/dHmIFHz/d.GRNKvHZtGXUn/hemmM9GuyZdUPlYkuP/T/YF3HMcjQQb2mNRTZQ/t/Ncj/c_ycN/DeYc1qNiQe';
        const successWait = 600000; // 10 Minutes (If Ad Plays)
        const failWait = 5000;      // 5 Seconds (If No Fill)
        // ----------------

        let didAdPlay = false; // The Truth Flag

        function log(msg) {
            document.getElementById('log').innerText = "Status: " + msg;
            console.log(msg);
        }

        var myPlayer = fluidPlayer('my-video', {
            layoutControls: {
                primaryColor: false, posterImage: false, playButtonShowing: false, 
                playPauseAnimation: false, fillToContainer: true, 
                autoPlay: true, mute: true
            },
            vastOptions: {
                allowVPAID: true, // Required for Hilltop
                adList: [{ roll: 'preRoll', vastTag: videoTag }],
                vastAdvanced: {
                    // 1. Explicit Failure (Hilltop says "No Ad")
                    noVastVideoCallback: function() { 
                        log("Ad Error / No Fill. Retrying in 5s...");
                        retry(); 
                    },
                    // 2. Explicit Success (Ad actually started)
                    vastVideoStartedCallback: function() {
                        didAdPlay = true; // Mark as success
                        log("Ad Started! Watching...");
                    },
                    // 3. Ad Finished
                    vastVideoEndedCallback: function() {
                        log("Ad Completed. Money made. Waiting 10m...");
                        // Don't reload yet, wait for content to finish
                    }
                }
            }
        });

        // 4. THE TRUTH CHECKER (Main Video Ended)
        // This fires when the player finishes whatever it was playing (Ad OR Placeholder)
        myPlayer.on('ended', function() {
            if (didAdPlay) {
                // If the Ad flag is TRUE, then we really succeeded.
                log("Cycle Complete (Success). Refreshing in 10 mins.");
                document.getElementById('video-container').style.display = 'none'; // Hide player
                setTimeout(() => window.location.reload(), successWait);
            } else {
                // If the Ad flag is FALSE, it means we skipped straight to the placeholder.
                log("Silent Fail (Skipped to Content). Retrying in 5s...");
                retry();
            }
        });

        // 5. Watchdog (In case it freezes)
        setTimeout(function() {
            if (!didAdPlay) {
                log("Watchdog: Stuck on black screen. Force Retry.");
                retry();
            }
        }, 8000);

        function retry() {
            setTimeout(() => window.location.reload(), failWait);
        }

    </script>
</body>
</html>
